<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Candidate Information</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-blue-200 font-sans flex flex-col min-h-screen">
    <!-- Sidebar -->
    <div class="bg-gray-300 text-black h-full w-64 fixed left-0 top-0 overflow-y-auto">
        <div class="px-11 py-2 w-full flex justify-center">
            <img src="l3.png" alt="Logo" class="w-full h-auto w-50 object-contain" />
        </div>
        <ul id="sidebarMenu" class="mt-8">
            <li class="px-5 py-3 hover:bg-gray-400">
                <a href="admin_dashboard.html" class="block">Dashboard</a>
            </li>
            <li class="px-5 py-3 hover:bg-gray-400">
                <a href="approve_voter.html" class="block">Approve Voter Registration</a>
            </li>
            <li class="px-5 py-3 hover:bg-gray-400">
                <a href="modify_voter_info.html" class="block">Modify Voter Information</a>
            </li>
            <li class="px-5 py-3 hover:bg-gray-400">
                <a href="modify_candidate_list.html" class="block">Add Candidate</a>
            </li>
            <li class="px-5 py-3 hover:bg-gray-400">
                <a href="result_publish.html" class="block">Publish Result</a>
            </li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="ml-64 p-8 flex-grow">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-gray-700">Add Candidate Information</h1>
            <div class="relative">
                <button id="profileBtn" class="focus:outline-none">
                    <img src="l2.png" alt="Profile" class="w-10 h-10 rounded-full cursor-pointer" />
                </button>
                <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-20">
                    <p class="block px-4 py-2 text-gray-800">
                        <strong>Email:</strong> <span id="user-email">Loading...</span>
                    </p>
                    <p class="block px-4 py-2 text-gray-800">
                        <strong>Username:</strong> <span id="user-name">Loading...</span>
                    </p>
                    <form action="/logout" method="post">
                        <button type="submit" class="w-full text-left block px-4 py-2 text-gray-800 hover:bg-gray-200">Logout</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Add Candidate Form -->
        <div class="bg-white p-8 rounded-lg shadow-lg border border-gray-300 space-y-6">
            <form id="addCandidateForm" class="space-y-4">
                <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
                    <div class="flex flex-col">
                        <label for="candidateName" class="text-gray-700 font-semibold">Candidate Name</label>
                        <input type="text" id="candidateName" class="mt-2 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required />
                    </div>
                    <div class="flex flex-col">
                        <label for="candidateEmail" class="text-gray-700 font-semibold">Email</label>
                        <input type="email" id="candidateEmail" class="mt-2 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required />
                    </div>
                    <div class="flex flex-col">
                        <label for="designation" class="text-gray-700 font-semibold">Designation</label>
                        <select id="designation" class="mt-2 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <!-- Options will be loaded dynamically -->
                        </select>
                    </div>
                    <div class="flex flex-col">
                        <label for="symbol" class="text-gray-700 font-semibold">Symbol</label>
                        <input type="file" id="symbol" class="mt-2 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required />
                    </div>
                    <div class="flex flex-col">
                        <label for="election" class="text-gray-700 font-semibold">Election</label>
                        <select id="election" class="mt-2 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <!-- Options will be loaded dynamically -->
                        </select>
                    </div>
                </div>
                <div>
                    <button type="submit" class="w-full p-4 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600 transition duration-300">Add Candidate</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer style="background-color: #42476d;" class="text-white py-4 fixed bottom-0 w-full">
        <div class="container mx-auto text-center">
            <p>&copy; 2024 Online Vote. All rights reserved.</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
    // Fetch and populate designations
    fetch("/getDesignations")
        .then((response) => response.json())
        .then((designations) => {
            if (designations.length > 0) {
                const designationSelect = document.getElementById("designation");
                designations.forEach((designation) => {
                    const option = document.createElement("option");
                    option.value = designation.designationId; // Corrected value
                    option.textContent = designation.designationName; // Corrected name
                    designationSelect.appendChild(option);
                });
            } else {
                alert("No designations found.");
            }
        })
        .catch((error) => {
            console.error("Error fetching designations:", error);
            alert("Failed to load designations. Please try again.");
        });

    // Fetch and populate elections
    fetch("/getElections")
        .then((response) => response.json())
        .then((elections) => {
            if (elections.length > 0) {
                const electionSelect = document.getElementById("election");
                elections.forEach((election) => {
                    const option = document.createElement("option");
                    option.value = election.electionId; // Corrected value
                    option.textContent = election.electionName; // Corrected name
                    electionSelect.appendChild(option);
                });
            } else {
                alert("No elections found.");
            }
        })
        .catch((error) => {
            console.error("Error fetching elections:", error);
            alert("Failed to load elections. Please try again.");
        });



            // Profile dropdown logic
            const profileBtn = document.getElementById("profileBtn");
            const profileDropdown = document.getElementById("profileDropdown");

            profileBtn.addEventListener("click", () => {
                profileDropdown.classList.toggle("hidden");
            });

            window.addEventListener("click", (e) => {
                if (!profileBtn.contains(e.target) && !profileDropdown.contains(e.target)) {
                    profileDropdown.classList.add("hidden");
                }
            });

            // Add Candidate Form Submission
            const addCandidateForm = document.getElementById("addCandidateForm");
            addCandidateForm.addEventListener("submit", (event) => {
                event.preventDefault();

                const formData = new FormData();
                formData.append("candidateName", document.getElementById("candidateName").value);
                formData.append("c_email", document.getElementById("candidateEmail").value);
                formData.append("symbol", document.getElementById("symbol").files[0]);
                formData.append("designationId", document.getElementById("designation").value);
                formData.append("electionId", document.getElementById("election").value);
                formData.append("password", "defaultpassword123"); // Set a default password

                fetch("/addCandidate", {
                    method: "POST",
                    body: formData,
                })
                    .then((response) => response.json())
                    .then((result) => {
                        if (result.success) {
                            alert("Candidate added successfully!");
                            addCandidateForm.reset();
                        } else {
                            alert("Failed to add candidate. Please try again.");
                        }
                    })
                    .catch((error) => {
                        console.error("Error adding candidate:", error);
                        alert("An error occurred. Please try again.");
                    });
            });
        });
    </script>
</body>

</html>
