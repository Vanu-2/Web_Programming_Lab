<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Administrator Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .hover-custom-blue:hover {
        background-color: #66cc99;
      }
    </style>
  </head>

  <body class="bg-blue-200 font-sans flex flex-col min-h-screen">
    <!-- Sidebar -->
    <div class="bg-gray-300 text-black h-full w-64 fixed left-0 top-0 overflow-y-auto">
      <div class="px-11 py-2 w-full flex justify-center">
        <img src="l3.png" alt="Logo" class="w-full h-auto object-contain" />
      </div>
      <ul id="sidebarMenu" class="mt-8">
        <li class="px-5 py-3 hover:bg-gray-400">
          <a href="admin_dashboard.html" class="block">Dashboard</a>
        </li>
        <li class="px-5 py-3 hover:bg-gray-400">
          <a href="approve_voter.html" class="block">Approve Voter Registration</a>
        </li>
        <li class="px-5 py-3 hover:bg-gray-400">
          <a href="modify_voter_info.html" class="block">Modify Voter Information</a>
        </li>
        <li class="px-5 py-3 hover:bg-gray-400">
          <a href="modify_candidate_list.html" class="block">Add Candidate</a>
        </li>
        <li class="px-5 py-3 hover:bg-gray-400">
          <a href="result_publish.html" class="block">Publish result</a>
        </li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="ml-64 p-8 flex-grow">
      <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold">Create New Election</h1>
      </div>

      <!-- Create Election Form -->
      <main class="flex-1 p-6">
        <div class="max-w-2xl mx-auto bg-white p-8 shadow-lg rounded-lg">
          <form id="createElectionForm">
            <div class="mb-4">
              <label for="electionName" class="block text-gray-700 font-semibold mb-2">Election Name:</label>
              <input
                type="text"
                id="electionName"
                name="electionName"
                required
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>

            <div class="mb-4">
              <label for="startDate" class="block text-gray-700 font-semibold mb-2">Start Date:</label>
              <input
                type="datetime-local"
                id="startDate"
                name="startDate"
                required
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>

            <div class="mb-4">
              <label for="endDate" class="block text-gray-700 font-semibold mb-2">End Date:</label>
              <input
                type="datetime-local"
                id="endDate"
                name="endDate"
                required
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>

            <div id="designationsContainer" class="mb-4">
              <label class="block text-gray-700 font-semibold mb-2">Designations:</label>
              <div class="flex items-center mb-2">
                <input
                  type="text"
                  placeholder="Designation Name"
                  class="designation-name w-full px-3 py-2 border border-gray-300 rounded-l-lg focus:outline-none"
                />
                <input
                  type="number"
                  placeholder="Max Position"
                  class="designation-max w-24 px-3 py-2 border-t border-b border-gray-300 focus:outline-none"
                />
                <button
                  type="button"
                  class="add-designation bg-green-500 text-white px-4 py-2 rounded-r-lg hover:bg-green-600"
                >
                  +
                </button>
              </div>
            </div>

            <button
              type="submit"
              class="w-full bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-600 transition duration-200"
            >
              Create Election
            </button>
          </form>
        </div>
      </main>
    </div>

    <!-- Footer -->
    <footer style="background-color: #42476d" class="text-white py-4 fixed bottom-0 w-full">
      <div class="container mx-auto text-center">
        <p>&copy; 2024 Online Vote. All rights reserved.</p>
      </div>
    </footer>

    <script>
      
      // Dynamic Designation Addition
      document.querySelector(".add-designation").addEventListener("click", () => {
        const container = document.getElementById("designationsContainer");
        const div = document.createElement("div");
        div.className = "flex items-center mb-2";
        div.innerHTML = `
          <input
            type="text"
            placeholder="Designation Name"
            class="designation-name w-full px-3 py-2 border border-gray-300 rounded-l-lg focus:outline-none"
          />
          <input
            type="number"
            placeholder="Max Position"
            class="designation-max w-24 px-3 py-2 border-t border-b border-gray-300 focus:outline-none"
          />
          <button
            type="button"
            class="remove-designation bg-red-500 text-white px-4 py-2 rounded-r-lg hover:bg-red-600"
          >
            -
          </button>
        `;
        container.appendChild(div);
        div.querySelector(".remove-designation").addEventListener("click", () => {
          div.remove();
        });
      });

      // Form Submission
      document.getElementById("createElectionForm").addEventListener("submit", async (event) => {
  event.preventDefault();

  const electionName = document.getElementById("electionName").value;
  const startDate = document.getElementById("startDate").value;
  const endDate = document.getElementById("endDate").value;
  const designations = Array.from(
    document.querySelectorAll("#designationsContainer .flex")
  ).map((designation) => ({
    name: designation.querySelector(".designation-name").value,
    maxPosition: designation.querySelector(".designation-max").value,
  }));

  try {
    const response = await fetch("/admin/create-election", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ electionName, startDate, endDate, designations }),
    });

    if (!response.ok) {
      const errorMessage = await response.text();
      throw new Error(errorMessage);
    }

    const message = await response.text();
    alert(message);
  } catch (error) {
    console.error("Error:", error);
    alert(error.message);
  }
});

    </script>
  </body>
</html>
